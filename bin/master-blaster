#!/usr/bin/env python3

# Master Blaster - Batch rename primary branches of GitHub code
# repositories Copyright (C) 2020 Gareth Field - field.gareth@gmail.com

# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.

# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.

# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <https://www.gnu.org/licenses/>.

from pathlib import Path
import sys
from vendor.lib.actions.shell import getCurrentBranch
from vendor.lib.actions.shell import setCurrentBranch
from vendor.lib.logging import loggingConfig
from vendor.lib.reporting import intro
from vendor.lib.auth import auth
from vendor.lib.options import wizard
from vendor.lib.dispatch import run
from vendor.lib.reporting import denoument
from vendor.lib.actions.shell_exceptions import GetBranchError
from vendor.lib.actions.shell_exceptions import SetBranchError

testing = True

loggingConfig(testing)

currentBranch = ""
if testing:
    try:
        currentBranch = getCurrentBranch(Path.cwd())
    except GetBranchError as err:
        print(err.message)
        sys.exit()

intro()

data = auth(testing)
dataWithOptions = wizard(data, testing)
run(dataWithOptions)

denoument()

if testing:
    try:
        setCurrentBranch(currentBranch)
    except SetBranchError as err:
        print(err.message)
        pass

sys.exit()
